# Notion Executive Assistant - Docker Compose
#
# Usage:
#   docker-compose up -d        # Start in background
#   docker-compose logs -f      # View logs
#   docker-compose down         # Stop
#   docker-compose restart      # Restart

version: '3.8'

services:
  # OpenClaw gateway (optional â€” for Telegram command handling)
  assistant:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: notion-assistant
    restart: unless-stopped
    env_file:
      - .env
    command: ["npx", "clawdbot", "gateway", "--verbose"]
    volumes:
      - ./credentials.json:/app/credentials.json:ro
      - ./token.json:/app/token.json
      - ./logs:/app/logs
      - clawdbot-data:/home/clawdbot/clawd
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Kalshi weather trading bot (autonomous, runs 24/7)
  kalshi-trader:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: kalshi-trader
    restart: unless-stopped
    env_file:
      - .env
    command: ["node", "scripts/kalshi-scheduler.js"]
    volumes:
      - kalshi-data:/home/clawdbot
      - ./kalshi-private-key.pem:/app/kalshi-private-key.pem:ro
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 64M
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  clawdbot-data:
  kalshi-data:
